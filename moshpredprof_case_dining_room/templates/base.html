<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–æ–ª–æ–≤–æ–π{% endblock %}</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>

  :root{
    --bg0: #f6f8fc;
    --bg1: #eef2ff;
    --bg2: #ecfeff;
    --surface: #ffffff;
    --surface2: #fbfcff;
    --border: rgba(15, 23, 42, 0.12);

    --text: #0f172a;
    --muted: rgba(15, 23, 42, 0.62);

    --primary: #2563eb;
    --primary-2: #06b6d4;

    --success: #16a34a;
    --warning: #f59e0b;
    --danger:  #ef4444;

    --shadow: 0 14px 34px rgba(15,23,42,0.10);
    --shadow2: 0 10px 26px rgba(15,23,42,0.08);

    --r-lg: 16px;
    --r-md: 12px;

    color-scheme: light;
  }

  body.dark{
    --bg0: #070b16;
    --bg1: #0b1630;
    --bg2: #06222a;

    --surface: rgba(17, 24, 39, 0.92);
    --surface2: rgba(17, 24, 39, 0.98);
    --border: rgba(148, 163, 184, 0.18);

    --text: #e5e7eb;
    --muted: rgba(229,231,235,0.62);

    --primary: #7aa2ff;
    --primary-2: #22c55e;

    --success: #22c55e;
    --warning: #fbbf24;
    --danger:  #fb7185;

    --shadow: 0 18px 55px rgba(0,0,0,0.55);
    --shadow2: 0 10px 28px rgba(0,0,0,0.35);

    color-scheme: dark;
  }
  html { overflow-y: scroll; scrollbar-gutter: stable; }

  body{
    margin:0;
    background:
      radial-gradient(1100px 800px at 18% 12%, var(--bg1), transparent 60%),
      radial-gradient(900px 700px at 85% 20%, rgba(37,99,235,0.14), transparent 60%),
      radial-gradient(900px 700px at 40% 90%, rgba(6,182,212,0.12), transparent 55%),
      var(--bg0);
    color: var(--text);
  }

  .text-muted, .small, small { color: var(--muted) !important; }

  .navbar, .card, .dropdown-menu, .modal-content{
    background: var(--surface) !important;
    color: var(--text) !important;
    border-color: var(--border) !important;
  }

  .border, .border-bottom, .border-top, .border-start, .border-end{
    border-color: var(--border) !important;
  }

  .shadow-soft{ box-shadow: var(--shadow) !important; }
  .card{ border-radius: var(--r-lg) !important; }

  .navbar-brand{ color: var(--text) !important; }

  .btn-primary{
    background: linear-gradient(135deg, var(--primary), var(--primary-2)) !important;
    border: none !important;
    box-shadow: 0 10px 24px rgba(37,99,235,0.25);
  }
  .btn-primary:hover{ filter: brightness(1.05); }

  .btn-outline-secondary{
    color: var(--text) !important;
    border-color: var(--border) !important;
    background: transparent !important;
  }
  .btn-outline-secondary:hover{
    background: rgba(37,99,235,0.10) !important;
    border-color: rgba(37,99,235,0.22) !important;
  }

  .badge-soft{
    background: rgba(37,99,235,0.12) !important;
    color: var(--primary) !important;
    border: 1px solid rgba(37,99,235,0.18) !important;
  }

  .alert{
    border-radius: var(--r-md) !important;
    border-color: var(--border) !important;
  }
  .alert-danger{
    background: rgba(239,68,68,0.10) !important;
    color: var(--text) !important;
    border-color: rgba(239,68,68,0.20) !important;
  }
  .alert-success{
    background: rgba(34,197,94,0.10) !important;
    color: var(--text) !important;
    border-color: rgba(34,197,94,0.20) !important;
  }

  .form-control, .form-select{
    background: var(--surface2) !important;
    color: var(--text) !important;
    border-color: var(--border) !important;
    border-radius: 12px !important;
  }
  .form-control:focus, .form-select:focus{
    border-color: rgba(37,99,235,0.50) !important;
    box-shadow: 0 0 0 .25rem rgba(37,99,235,0.15) !important;
  }
  .form-control::placeholder{ color: rgba(148,163,184,0.9) !important; }
  body:not(.dark) .form-control::placeholder{ color: rgba(15,23,42,0.45) !important; }

  .table{
    color: var(--text) !important;
    --bs-table-bg: transparent;
    --bs-table-striped-bg: rgba(37,99,235,0.06);
    --bs-table-hover-bg: rgba(37,99,235,0.08);
  }
  .table thead th{
    background: var(--surface2) !important;
    color: var(--muted) !important;
    border-bottom-color: var(--border) !important;
  }
  .table td, .table th{
    border-color: var(--border) !important;
    vertical-align: middle;
  }

  .dropdown-item{ color: var(--text) !important; }
  .dropdown-item:hover{ background: rgba(37,99,235,0.10) !important; }

  nav, .navbar, .container-fluid, .container { max-width: 100%; box-sizing: border-box; }
  .navbar-nav .nav-link{
    position: relative;
    padding: 6px 12px;
    border-radius: 999px;
    transition: background .15s ease, color .15s ease;
    font-weight: 600;
    color: var(--muted) !important;
  }
  .navbar-nav .nav-link:hover{
    background: rgba(37,99,235,0.10);
    color: var(--text) !important;
  }
  .navbar-nav .nav-link.active{
    background: linear-gradient(135deg, rgba(37,99,235,0.22), rgba(6,182,212,0.14));
    color: var(--primary) !important;
    font-weight: 700;
    box-shadow: inset 0 0 0 1px rgba(37,99,235,0.28);
  }
  body.dark .navbar-nav .nav-link.active{
    background: linear-gradient(135deg, rgba(122,162,255,0.22), rgba(34,197,94,0.14));
    box-shadow: inset 0 0 0 1px rgba(122,162,255,0.30);
  }
  </style>

  {% block head %}{% endblock %}
</head>

<body>

<nav class="navbar navbar-expand-lg bg-white border-bottom">
  <div class="container-fluid px-3">

    <a class="navbar-brand fw-semibold" href="{{ url_for('root') }}">
      üçΩÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–æ–ª–æ–≤–æ–π
    </a>

    <button class="navbar-toggler" type="button"
            data-bs-toggle="collapse" data-bs-target="#nav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="nav">
      {% set role = (user.role if user and user.role is defined else (user.db_user_type if user else None)) %}
      {% set ep = request.endpoint or '' %}

      <ul class="navbar-nav me-auto">
        {% if role %}
          <li class="nav-item">
            <a class="nav-link {% if ep in ['dashboard'] %}active{% endif %}" href="{{ url_for('dashboard') }}">–ü–∞–Ω–µ–ª—å</a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if ep in ['menu'] %}active{% endif %}" href="{{ url_for('menu') }}">–ú–µ–Ω—é</a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if ep.startswith('availability') %}active{% endif %}" href="{{ url_for('availability') }}">–û—Å—Ç–∞—Ç–∫–∏</a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if ep.startswith('orders') %}active{% endif %}" href="{{ url_for('orders') }}">–ó–∞—è–≤–∫–∏</a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if ep.startswith('notifications') %}active{% endif %}" href="{{ url_for('notifications') }}">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</a>
          </li>

          {% if role in ['student','just_user'] %}
            <li class="nav-item">
              <a class="nav-link {% if ep.startswith('complaint') %}active{% endif %}" href="{{ url_for('complaint') }}">–ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è</a>
            </li>
          {% endif %}
          {% if role in ['cook','admin','staff'] %}
            <li class="nav-item">
              <a class="nav-link {% if ep.startswith('complaints') %}active{% endif %}" href="{{ url_for('complaints') }}">–ñ–∞–ª–æ–±—ã</a>
            </li>
          {% endif %}

          {% if role in ['cook','admin','staff'] %}
            <li class="nav-item">
              <a class="nav-link {% if ep.startswith('serve') %}active{% endif %}" href="{{ url_for('serve') }}">–í—ã–¥–∞—á–∞</a>
            </li>
            <li class="nav-item">
              <a class="nav-link {% if ep.startswith('writeoff') %}active{% endif %}" href="{{ url_for('writeoff') }}">–°–ø–∏—Å–∞–Ω–∏–µ</a>
            </li>
            <li class="nav-item">
              <a class="nav-link {% if ep.startswith('procurement') %}active{% endif %}" href="{{ url_for('procurement') }}">–ó–∞–∫—É–ø–∫–∏</a>
            </li>
          {% endif %}

          {% if role == 'admin' %}
            <li class="nav-item">
              <a class="nav-link {% if ep.startswith('users') %}active{% endif %}" href="{{ url_for('users') }}">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
            </li>
            <li class="nav-item">
              <a class="nav-link {% if ep.startswith('reports') %}active{% endif %}" href="{{ url_for('reports') }}">–û—Ç—á—ë—Ç—ã</a>
            </li>
            <li class="nav-item">
              <a class="nav-link {% if ep.startswith('analytics') %}active{% endif %}" href="{{ url_for('analytics') }}">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</a>
            </li>
          {% endif %}

          <li class="nav-item">
            <a class="nav-link {% if ep.startswith('payments') %}active{% endif %}" href="{{ url_for('payments') }}">–û–ø–ª–∞—Ç–∞</a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if ep.startswith('subscriptions') %}active{% endif %}" href="{{ url_for('subscriptions') }}">–ê–±–æ–Ω–µ–º–µ–Ω—Ç—ã</a>
          </li>
        {% endif %}
      </ul>

      <ul class="navbar-nav ms-auto align-items-center">
        
        <li class="nav-item me-2">
          <button id="themeToggle" class="btn btn-outline-secondary btn-sm" type="button">üåô</button>
        </li>

        {% if user %}
          <li class="nav-item d-flex align-items-center me-2">
            <span class="badge badge-soft">
              {% if role in ['student','just_user'] %}—É—á–µ–Ω–∏–∫
              {% elif role == 'cook' %}–ø–æ–≤–∞—Ä
              {% else %}–∞–¥–º–∏–Ω/—Å–æ—Ç—Ä—É–¥–Ω–∏–∫{% endif %}
            </span>
          </li>
          <li class="nav-item d-flex align-items-center me-2">
            <span class="text-muted small">
              {{ user.name if user.name is defined else user.db_name }}
            </span>
          </li>

          <li class="nav-item">
            <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('logout') }}">–í—ã–π—Ç–∏</a>
          </li>
        {% else %}
          <li class="nav-item">
            <a class="btn btn-primary btn-sm" href="{{ url_for('login') }}">–í–æ–π—Ç–∏</a>
          </li>
        {% endif %}
      </ul>
    </div>
  </div>
</nav>

<main class="container my-4">
  {% if error %}<div class="alert alert-danger">{{ error }}</div>{% endif %}
  {% if message %}<div class="alert alert-success">{{ message }}</div>{% endif %}
  {% block content %}{% endblock %}
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
{% block scripts %}{% endblock %}

<script>
  const btn = document.getElementById('themeToggle');
  const saved = localStorage.getItem('theme');

  if (saved === 'dark') {
    document.body.classList.add('dark');
    if (btn) btn.textContent = '‚òÄÔ∏è';
  } else {
    if (btn) btn.textContent = 'üåô';
  }

  if (btn) {
    btn.addEventListener('click', () => {
      document.body.classList.toggle('dark');
      const isDark = document.body.classList.contains('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      btn.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
    });
  }
</script>

</body>
</html>
